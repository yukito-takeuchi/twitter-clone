# Twitter Clone ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

> **ç›®çš„**: æ–°ã—ã„Claude Codeä¼šè©±ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç´ æ—©ãç†è§£ã™ã‚‹ãŸã‚ã®åŒ…æ‹¬çš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

---

## ğŸ“‹ ç›®æ¬¡

1. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦](#1-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦)
2. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#2-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
3. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ](#3-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ )
4. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#4-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
5. [å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½](#5-å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½)
6. [APIè¨­è¨ˆ](#6-apiè¨­è¨ˆ)
7. [ä¸»è¦ãªå®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ](#7-ä¸»è¦ãªå®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ)
8. [æ—¢çŸ¥ã®èª²é¡Œã¨ä»Šå¾Œã®äºˆå®š](#8-æ—¢çŸ¥ã®èª²é¡Œã¨ä»Šå¾Œã®äºˆå®š)

---

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### ç›®çš„
- **Express ã®ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—**ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã§ä½¿ç”¨ã—ãŸãƒ„ãƒ¼ãƒ«ã®å®Ÿè·µæ´»ç”¨
- ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã§ã®Twitterã‚¯ãƒ­ãƒ¼ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™º

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ¦‚è¦
æœ¬æ ¼çš„ãªã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼ˆTwitteré¢¨ï¼‰ã§ã€æŠ•ç¨¿ã€ã„ã„ã­ã€ãƒ•ã‚©ãƒ­ãƒ¼ã€DMã€é€šçŸ¥ãªã©ã®ä¸»è¦æ©Ÿèƒ½ã‚’å®Ÿè£…ã€‚

### ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Vercel (Next.js)
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Heroku (DockeråŒ–ã•ã‚ŒãŸExpress.js)
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Heroku Postgres
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Google Cloud Storage (ç”»åƒãƒ»å‹•ç”»)

---

## 2. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
```
- TypeScript
- Next.js 14 (App Router)
- Material-UI (MUI)
- Tailwind CSS
- Socket.io Client (ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡)
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
```
- Node.js
- Express.js
- TypeScript
- PostgreSQL
- Socket.io (ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡)
```

### ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹
```
- Docker (ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠåŒ–)
- Vercel (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°)
- Heroku (ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°)
- Google Cloud Storage (ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜)
- Firebase Authentication (ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼)
- Datadog (ç›£è¦–ãƒ»ãƒ­ã‚®ãƒ³ã‚°)
- Mailgun (ãƒ¡ãƒ¼ãƒ«é€ä¿¡)
- pnpm (ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†)
```

---

## 3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
project-new-3/
â”œâ”€â”€ frontend/                    # Next.js ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/                # App Router ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/        # èªè¨¼ãƒšãƒ¼ã‚¸ (login, register)
â”‚   â”‚   â”‚   â”œâ”€â”€ bookmarks/     # ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ä¸€è¦§
â”‚   â”‚   â”‚   â”œâ”€â”€ dm/            # ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
â”‚   â”‚   â”‚   â”œâ”€â”€ home/          # ãƒ›ãƒ¼ãƒ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
â”‚   â”‚   â”‚   â”œâ”€â”€ notifications/ # é€šçŸ¥ä¸€è¦§
â”‚   â”‚   â”‚   â”œâ”€â”€ post/          # æŠ•ç¨¿è©³ç´°
â”‚   â”‚   â”‚   â”œâ”€â”€ profile/       # ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”‚   â””â”€â”€ search/        # æ¤œç´¢ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”œâ”€â”€ components/        # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ common/        # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (VideoPlayer, ImageUploadç­‰)
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/        # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ posts/         # æŠ•ç¨¿é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â””â”€â”€ profile/       # ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ contexts/          # React Context (AuthContextç­‰)
â”‚   â”‚   â”œâ”€â”€ hooks/             # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ (useInfiniteScrollç­‰)
â”‚   â”‚   â”œâ”€â”€ lib/               # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»API
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts         # API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”‚   â””â”€â”€ firebase.ts    # Firebaseè¨­å®š
â”‚   â”‚   â”œâ”€â”€ types/             # TypeScriptå‹å®šç¾©
â”‚   â”‚   â””â”€â”€ utils/             # ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
â”‚   â””â”€â”€ public/                # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”‚
â”œâ”€â”€ backend/                     # Express.js ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config/            # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« (database, firebase, gcsç­‰)
â”‚   â”‚   â”œâ”€â”€ controllers/       # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚   â”‚   â”‚   â”œâ”€â”€ userController.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ postController.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ messageController.ts
â”‚   â”‚   â”‚   â””â”€â”€ ... (è¨ˆ13ãƒ•ã‚¡ã‚¤ãƒ«)
â”‚   â”‚   â”œâ”€â”€ middlewares/       # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ (èªè¨¼ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°)
â”‚   â”‚   â”œâ”€â”€ models/            # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«å±¤
â”‚   â”‚   â”‚   â”œâ”€â”€ User.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Post.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Message.ts
â”‚   â”‚   â”‚   â””â”€â”€ ... (è¨ˆ14ãƒ•ã‚¡ã‚¤ãƒ«)
â”‚   â”‚   â”œâ”€â”€ routes/            # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å®šç¾©
â”‚   â”‚   â”‚   â”œâ”€â”€ users.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ posts.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ messages.ts
â”‚   â”‚   â”‚   â””â”€â”€ ... (è¨ˆ12ãƒ•ã‚¡ã‚¤ãƒ«)
â”‚   â”‚   â”œâ”€â”€ scripts/           # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”‚   â”œâ”€â”€ services/          # å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº
â”‚   â”‚   â”œâ”€â”€ utils/             # ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
â”‚   â”‚   â””â”€â”€ index.ts           # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ migrations/            # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ (10ãƒ•ã‚¡ã‚¤ãƒ«)
â”‚   â”œâ”€â”€ uploads/               # ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (é–‹ç™ºç”¨)
â”‚   â””â”€â”€ Dockerfile             # Dockerã‚³ãƒ³ãƒ†ãƒŠå®šç¾©
â”‚
â”œâ”€â”€ docker-compose.yml         # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨Docker Compose
â”œâ”€â”€ heroku.yml                 # Herokuãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š
â””â”€â”€ README.md                  # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆREADME
```

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### ERå›³ï¼ˆä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   users     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)     â”‚â”€â”€â”
â”‚ firebase_uidâ”‚  â”‚
â”‚ email       â”‚  â”‚
â”‚ username    â”‚  â”‚
â”‚ display_nameâ”‚  â”‚
â”‚ created_at  â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚        â”‚                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  profiles    â”‚ â”‚                  â”‚   follows        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)      â”‚ â”‚                  â”‚ id (PK)          â”‚
â”‚ user_id (FK) â”‚ â”‚                  â”‚ follower_id (FK) â”‚
â”‚ bio          â”‚ â”‚                  â”‚ following_id(FK) â”‚
â”‚ avatar_url   â”‚ â”‚                  â”‚ created_at       â”‚
â”‚ cover_image  â”‚ â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ birth_date   â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    posts     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      likes        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)      â”‚â”€â”€â”                   â”‚ id (PK)           â”‚
â”‚ user_id (FK) â”‚  â”‚                   â”‚ user_id (FK)      â”‚
â”‚ content      â”‚  â”‚                   â”‚ post_id (FK)      â”‚
â”‚ image_url    â”‚  â”‚                   â”‚ created_at        â”‚
â”‚ video_url    â”‚  â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ reply_to_id  â”‚  â”‚
â”‚ quoted_post  â”‚  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ is_pinned    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   reposts        â”‚
â”‚ view_count   â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ created_at   â”‚             â”‚ id (PK)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ user_id (FK)     â”‚
        â”‚                    â”‚ post_id (FK)     â”‚
        â”‚                    â”‚ is_pinned        â”‚
        â”‚                    â”‚ created_at       â”‚
        â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   bookmarks      â”‚
                             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                             â”‚ id (PK)          â”‚
                             â”‚ user_id (FK)     â”‚
                             â”‚ post_id (FK)     â”‚
                             â”‚ created_at       â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ conversations   â”‚          â”‚    messages      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ id (PK)          â”‚
â”‚ participant1_id â”‚          â”‚ conversation_id  â”‚
â”‚ participant2_id â”‚          â”‚ sender_id (FK)   â”‚
â”‚ last_message_at â”‚          â”‚ message_type     â”‚
â”‚ is_active       â”‚          â”‚ content          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ image_id (FK)    â”‚
                             â”‚ shared_post_id   â”‚
                             â”‚ is_deleted       â”‚
                             â”‚ created_at       â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ message_read_     â”‚
                             â”‚    status         â”‚
                             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                             â”‚ id (PK)           â”‚
                             â”‚ message_id (FK)   â”‚
                             â”‚ user_id (FK)      â”‚
                             â”‚ read_at           â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ notifications   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)         â”‚
â”‚ user_id (FK)    â”‚
â”‚ type            â”‚ â† 'like', 'follow', 'reply', 'repost', 'dm'ç­‰
â”‚ content (JSONB) â”‚
â”‚ related_user_id â”‚
â”‚ related_post_id â”‚
â”‚ is_read         â”‚
â”‚ created_at      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   images     â”‚          â”‚   videos     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)      â”‚          â”‚ id (PK)      â”‚
â”‚ user_id (FK) â”‚          â”‚ user_id (FK) â”‚
â”‚ post_id (FK) â”‚          â”‚ post_id (FK) â”‚
â”‚ url          â”‚          â”‚ url          â”‚
â”‚ file_name    â”‚          â”‚ thumbnail_urlâ”‚
â”‚ file_size    â”‚          â”‚ duration     â”‚
â”‚ mime_type    â”‚          â”‚ file_size    â”‚
â”‚ width/height â”‚          â”‚ width/height â”‚
â”‚ storage_type â”‚          â”‚ storage_type â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ†ãƒ¼ãƒ–ãƒ«è©³ç´°

#### ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«

**users** - ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æƒ…å ±
- Firebase UIDã¨ã®ç´ä»˜ã‘
- email, username (ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„)

**profiles** - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±
- bio, location, website
- avatar_url, cover_image_url (GCS)
- birth_date

**posts** - æŠ•ç¨¿
- content (æœ€å¤§280æ–‡å­—)
- image_url OR video_url (æ’ä»–åˆ¶ç´„)
- reply_to_id (ãƒªãƒ—ãƒ©ã‚¤å…ˆ)
- quoted_post_id (å¼•ç”¨ãƒªãƒ„ã‚¤ãƒ¼ãƒˆ)
- is_pinned (ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å›ºå®šè¡¨ç¤º)
- view_count (é–²è¦§æ•°)

**likes** - ã„ã„ã­
- user_id + post_id ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„

**follows** - ãƒ•ã‚©ãƒ­ãƒ¼é–¢ä¿‚
- follower_id (ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹äºº)
- following_id (ãƒ•ã‚©ãƒ­ãƒ¼ã•ã‚Œã‚‹äºº)
- no_self_follow åˆ¶ç´„

**reposts** - ãƒªãƒ„ã‚¤ãƒ¼ãƒˆ
- user_id + post_id ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„
- is_pinned (ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å›ºå®šè¡¨ç¤º)

**bookmarks** - ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯
- user_id + post_id ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„

#### DMé–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«

**conversations** - DMä¼šè©±ã‚¹ãƒ¬ãƒƒãƒ‰
- participant1_id < participant2_id (å¸¸ã«ã‚½ãƒ¼ãƒˆ)
- 1å¯¾1ä¼šè©±ã®ã¿ã‚µãƒãƒ¼ãƒˆ

**messages** - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- message_type: 'text', 'image', 'post_share'
- content (æœ€å¤§1000æ–‡å­—)
- is_deleted (è«–ç†å‰Šé™¤)

**message_read_status** - æ—¢èª­ç®¡ç†
- message_id + user_id ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„

#### ãã®ä»–

**notifications** - é€šçŸ¥
- notification_type: 'like', 'follow', 'reply', 'repost', 'dm'
- content (JSONB) - é€šçŸ¥è©³ç´°ãƒ‡ãƒ¼ã‚¿
- is_read, read_at

**images** - ç”»åƒãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
- storage_type: 'local' or 'gcs'

**videos** - å‹•ç”»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
- thumbnail_url (è‡ªå‹•ç”Ÿæˆã‚µãƒ ãƒã‚¤ãƒ«)
- duration (ç§’æ•°)

### é‡è¦ãªãƒ“ãƒ¥ãƒ¼

**posts_with_stats** - æŠ•ç¨¿ + çµ±è¨ˆæƒ…å ±
- like_count, reply_count ã‚’è‡ªå‹•è¨ˆç®—
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’JOINæ¸ˆã¿

**users_with_stats** - ãƒ¦ãƒ¼ã‚¶ãƒ¼ + çµ±è¨ˆæƒ…å ±
- follower_count, following_count, post_count ã‚’è‡ªå‹•è¨ˆç®—

---

## 5. å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

### Phase 1 (MVP) - å®Ÿè£…å®Œäº† âœ…

#### èªè¨¼æ©Ÿèƒ½
- [x] Firebase Authentication çµ±åˆ
- [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
- [x] JWT ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

#### æŠ•ç¨¿æ©Ÿèƒ½ (CRUD)
- [x] æŠ•ç¨¿ä½œæˆ (ãƒ†ã‚­ã‚¹ãƒˆã€ç”»åƒã€å‹•ç”»)
- [x] æŠ•ç¨¿é–²è¦§ (ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«)
- [x] æŠ•ç¨¿ç·¨é›†
- [x] æŠ•ç¨¿å‰Šé™¤ (è«–ç†å‰Šé™¤)
- [x] ãƒªãƒ—ãƒ©ã‚¤æ©Ÿèƒ½
- [x] å¼•ç”¨ãƒªãƒ„ã‚¤ãƒ¼ãƒˆ
- [x] æŠ•ç¨¿å›ºå®š (ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸)
- [x] é–²è¦§æ•°ã‚«ã‚¦ãƒ³ãƒˆ

#### ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ©Ÿèƒ½ (CRUD)
- [x] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆ
- [x] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«é–²è¦§
- [x] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†
- [x] ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (GCS)
- [x] ã‚«ãƒãƒ¼ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (GCS)
- [x] ç·ãƒã‚¹ãƒˆæ•°ã®è¡¨ç¤º

#### ã„ã„ã­æ©Ÿèƒ½
- [x] æŠ•ç¨¿ã«ã„ã„ã­
- [x] ã„ã„ã­è§£é™¤
- [x] ã„ã„ã­æ•°è¡¨ç¤º
- [x] ã„ã„ã­ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§

#### ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½
- [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚©ãƒ­ãƒ¼
- [x] ãƒ•ã‚©ãƒ­ãƒ¼è§£é™¤
- [x] ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ãƒ»ãƒ•ã‚©ãƒ­ãƒ¼æ•°è¡¨ç¤º
- [x] ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ä¸€è¦§
- [x] ãƒ•ã‚©ãƒ­ãƒ¼ä¸­ä¸€è¦§

#### ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- [x] ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (GCSçµ±åˆ)
- [x] å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (GCSçµ±åˆ)
- [x] å‹•ç”»ã‚µãƒ ãƒã‚¤ãƒ«è‡ªå‹•ç”Ÿæˆ
- [x] ç”»åƒãƒ»å‹•ç”»ã®æ’ä»–åˆ¶ç´„ (1æŠ•ç¨¿1ãƒ¡ãƒ‡ã‚£ã‚¢)
- [x] ç¸¦é•·å‹•ç”»ã®é©åˆ‡ãªã‚µã‚¤ã‚ºèª¿æ•´ (max-height: 400px)

#### ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤º
- [x] ãƒ›ãƒ¼ãƒ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ (ãƒ•ã‚©ãƒ­ãƒ¼ä¸­ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¨¿)
- [x] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æŠ•ç¨¿ä¸€è¦§
- [x] ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« (IntersectionObserver)
- [x] ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ (offset-based)

### Phase 2 (æ‹¡å¼µæ©Ÿèƒ½) - éƒ¨åˆ†å®Ÿè£… ğŸš§

#### DM (ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸) æ©Ÿèƒ½
- [x] Socket.io çµ±åˆ
- [x] 1å¯¾1ãƒãƒ£ãƒƒãƒˆ
- [x] ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡
- [x] ç”»åƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
- [x] æŠ•ç¨¿å…±æœ‰
- [x] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡
- [x] æ—¢èª­æ©Ÿèƒ½
- [x] æœªèª­æ•°è¡¨ç¤º
- [ ] ã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒ£ãƒƒãƒˆ (æœªå®Ÿè£…)

#### é€šçŸ¥æ©Ÿèƒ½
- [x] é€šçŸ¥ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ
- [x] Socket.io ã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥
- [x] ã„ã„ã­é€šçŸ¥
- [x] ãƒ•ã‚©ãƒ­ãƒ¼é€šçŸ¥
- [x] ãƒªãƒ—ãƒ©ã‚¤é€šçŸ¥
- [x] ãƒªãƒ„ã‚¤ãƒ¼ãƒˆé€šçŸ¥
- [x] DMé€šçŸ¥
- [x] æœªèª­é€šçŸ¥æ•°è¡¨ç¤º
- [ ] ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ (æœªå®Ÿè£…)

#### æ¤œç´¢æ©Ÿèƒ½
- [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ (username, display_name)
- [ ] ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°æ¤œç´¢ (æœªå®Ÿè£…)
- [ ] å…¨æ–‡æ¤œç´¢ (æœªå®Ÿè£…)

#### ãƒªãƒ„ã‚¤ãƒ¼ãƒˆæ©Ÿèƒ½
- [x] ãƒªãƒ„ã‚¤ãƒ¼ãƒˆä½œæˆãƒ»è§£é™¤
- [x] å¼•ç”¨ãƒªãƒ„ã‚¤ãƒ¼ãƒˆ
- [x] ãƒªãƒ„ã‚¤ãƒ¼ãƒˆæ•°è¡¨ç¤º
- [x] ãƒªãƒ„ã‚¤ãƒ¼ãƒˆå›ºå®š (ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«)

#### ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ©Ÿèƒ½
- [x] æŠ•ç¨¿ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯
- [x] ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯è§£é™¤
- [x] ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ä¸€è¦§è¡¨ç¤º

#### ãã®ä»–
- [x] View ã‚«ã‚¦ãƒ³ãƒˆ (æŠ•ç¨¿é–²è¦§æ•°)
- [x] å›ºå®šæŠ•ç¨¿ãƒãƒƒã‚¸ (ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã®ã¿è¡¨ç¤º)

---

## 6. APIè¨­è¨ˆ

### èªè¨¼
- ã™ã¹ã¦ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ Firebase Authentication ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦
- ãƒ˜ãƒƒãƒ€ãƒ¼: `Authorization: Bearer <token>`

### ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£
```
GET    /api/users/:id                    # ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—
GET    /api/users/username/:username     # ãƒ¦ãƒ¼ã‚¶ãƒ¼åã§å–å¾— (+ ç·ãƒã‚¹ãƒˆæ•°)
GET    /api/users/firebase/:uid          # Firebase UIDã§å–å¾—
POST   /api/users                        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
PUT    /api/users/:id                    # ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°
GET    /api/users/search?q=query         # ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢
```

#### æŠ•ç¨¿é–¢é€£
```
GET    /api/posts                        # ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å–å¾—
GET    /api/posts/:id                    # æŠ•ç¨¿è©³ç´°å–å¾—
GET    /api/posts/user/:userId           # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¨¿ä¸€è¦§
GET    /api/posts/:id/replies            # ãƒªãƒ—ãƒ©ã‚¤ä¸€è¦§
POST   /api/posts                        # æŠ•ç¨¿ä½œæˆ
PUT    /api/posts/:id                    # æŠ•ç¨¿æ›´æ–°
DELETE /api/posts/:id                    # æŠ•ç¨¿å‰Šé™¤
POST   /api/posts/:id/pin                # æŠ•ç¨¿å›ºå®š
DELETE /api/posts/:id/pin                # æŠ•ç¨¿å›ºå®šè§£é™¤
GET    /api/posts/:id/pinned             # å›ºå®šæŠ•ç¨¿å–å¾—
```

#### ã„ã„ã­é–¢é€£
```
POST   /api/likes/:postId                # ã„ã„ã­ä½œæˆ
DELETE /api/likes/:postId                # ã„ã„ã­å‰Šé™¤
GET    /api/likes/:postId/users          # ã„ã„ã­ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
```

#### ãƒ•ã‚©ãƒ­ãƒ¼é–¢é€£
```
POST   /api/follows/:userId              # ãƒ•ã‚©ãƒ­ãƒ¼
DELETE /api/follows/:userId              # ãƒ•ã‚©ãƒ­ãƒ¼è§£é™¤
GET    /api/follows/:userId/followers    # ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ä¸€è¦§
GET    /api/follows/:userId/following    # ãƒ•ã‚©ãƒ­ãƒ¼ä¸­ä¸€è¦§
GET    /api/follows/check/:userId        # ãƒ•ã‚©ãƒ­ãƒ¼çŠ¶æ…‹ç¢ºèª
```

#### ãƒªãƒ„ã‚¤ãƒ¼ãƒˆé–¢é€£
```
POST   /api/reposts/:postId              # ãƒªãƒ„ã‚¤ãƒ¼ãƒˆä½œæˆ
DELETE /api/reposts/:postId              # ãƒªãƒ„ã‚¤ãƒ¼ãƒˆå‰Šé™¤
POST   /api/reposts/:postId/pin          # ãƒªãƒ„ã‚¤ãƒ¼ãƒˆå›ºå®š
DELETE /api/reposts/:postId/pin          # ãƒªãƒ„ã‚¤ãƒ¼ãƒˆå›ºå®šè§£é™¤
GET    /api/reposts/user/:userId/pinned  # å›ºå®šãƒªãƒ„ã‚¤ãƒ¼ãƒˆå–å¾—
```

#### ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯é–¢é€£
```
GET    /api/bookmarks                    # ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ä¸€è¦§
POST   /api/bookmarks/:postId            # ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯è¿½åŠ 
DELETE /api/bookmarks/:postId            # ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯å‰Šé™¤
```

#### DMé–¢é€£
```
GET    /api/conversations                # ä¼šè©±ä¸€è¦§
GET    /api/conversations/:id            # ä¼šè©±è©³ç´°å–å¾—
POST   /api/conversations                # ä¼šè©±ä½œæˆ
GET    /api/messages/:conversationId     # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§
POST   /api/messages                     # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
POST   /api/messages/:messageId/read     # æ—¢èª­ãƒãƒ¼ã‚¯
```

#### é€šçŸ¥é–¢é€£
```
GET    /api/notifications                # é€šçŸ¥ä¸€è¦§
GET    /api/notifications/unread/count   # æœªèª­æ•°å–å¾—
PUT    /api/notifications/:id/read       # æ—¢èª­ãƒãƒ¼ã‚¯
PUT    /api/notifications/read-all       # å…¨æ—¢èª­
```

#### ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
```
POST   /api/images/upload                # ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (GCS)
POST   /api/videos/upload                # å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (GCS)
```

#### ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«é–¢é€£
```
GET    /api/profiles/:userId             # ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
PUT    /api/profiles/:userId             # ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

#### æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
```json
{
  "status": "success",
  "data": {
    // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿
  }
}
```

#### ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
```json
{
  "status": "error",
  "message": "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
}
```

---

## 7. ä¸»è¦ãªå®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

#### ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè£…
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `/frontend/src/hooks/useInfiniteScroll.ts`
- **å®Ÿè£…æ–¹æ³•**: IntersectionObserver APIä½¿ç”¨
- **é‡è¦ãƒã‚¤ãƒ³ãƒˆ**:
  - ã‚»ãƒ³ãƒãƒãƒ«è¦ç´ ã®ãƒã‚¦ãƒ³ãƒˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è€ƒæ…®
  - ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯refãƒ‘ã‚¿ãƒ¼ãƒ³ã§çŠ¶æ…‹å¤‰åŒ–ã‚’æ¤œçŸ¥
  - React StrictModeã§ã®äºŒé‡å®Ÿè¡Œã«å¯¾å¿œ

```typescript
// ã‚»ãƒ³ãƒãƒãƒ«è¦ç´ ãŒãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§çŠ¶æ…‹æ›´æ–°
const setSentinelRef = useCallback((node: HTMLDivElement | null) => {
  sentinelRef.current = node;
  if (node) {
    setSentinelMounted(true);
  }
}, []);

// sentinelMountedãŒå¤‰ã‚ã£ãŸã‚‰Observerã‚’ä½œæˆ
useEffect(() => {
  if (!hasMore || loading || !sentinelMounted) return;

  const observer = new IntersectionObserver(...);
  observer.observe(sentinelRef.current);

  return () => observer.disconnect();
}, [hasMore, loading, sentinelMounted]);
```

#### å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `/frontend/src/components/common/VideoPlayer.tsx`
- **å®Ÿè£…æ–¹æ³•**:
  - Flexboxã§ä¸­å¤®å¯„ã›
  - `max-height: 400px`ã§ç¸¦é•·å‹•ç”»ã‚’åˆ¶é™
  - `object-fit: contain`ã§é»’å¸¯è¡¨ç¤º
  - è‡ªå‹•å†ç”Ÿã€ãƒŸãƒ¥ãƒ¼ãƒˆã€ãƒ«ãƒ¼ãƒ—æ©Ÿèƒ½

#### æŠ•ç¨¿ã‚«ãƒ¼ãƒ‰
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `/frontend/src/components/posts/PostCard.tsx`
- **æ©Ÿèƒ½**:
  - æŠ•ç¨¿ã€ãƒªãƒ—ãƒ©ã‚¤ã€ãƒªãƒ„ã‚¤ãƒ¼ãƒˆã€å¼•ç”¨ãƒªãƒ„ã‚¤ãƒ¼ãƒˆã®è¡¨ç¤º
  - ã„ã„ã­ã€ãƒªãƒ„ã‚¤ãƒ¼ãƒˆã€ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ“ä½œ
  - å›ºå®šæŠ•ç¨¿ãƒãƒƒã‚¸ (`showPinnedBadge` prop)
  - ç”»åƒãƒ»å‹•ç”»ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

#### æŠ•ç¨¿å–å¾—ã®æœ€é©åŒ–
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `/backend/src/models/Post.ts`
- **å®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ**:
  - `posts_with_stats` ãƒ“ãƒ¥ãƒ¼ã‚’ä½¿ç”¨ã—ã¦çµ±è¨ˆæƒ…å ±ã‚’åŠ¹ç‡çš„ã«å–å¾—
  - ã‚ªãƒªã‚¸ãƒŠãƒ«æŠ•ç¨¿ã¨ãƒªãƒ„ã‚¤ãƒ¼ãƒˆã‚’UNIONã§çµ±åˆ
  - å›ºå®šæŠ•ç¨¿ã‚’é™¤å¤– (`is_pinned = false`)
  - ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ (LIMIT + OFFSET)

```typescript
// countByUser ãƒ¡ã‚½ãƒƒãƒ‰ - ç·ãƒã‚¹ãƒˆæ•°ã‚’å–å¾—
static async countByUser(userId: string): Promise<number> {
  const result = await query(`
    SELECT COUNT(*) as count FROM (
      -- ã‚ªãƒªã‚¸ãƒŠãƒ«æŠ•ç¨¿
      SELECT id FROM posts
      WHERE user_id = $1 AND reply_to_id IS NULL
        AND repost_of_id IS NULL AND is_deleted = false

      UNION ALL

      -- ãƒªãƒ„ã‚¤ãƒ¼ãƒˆ
      SELECT r.post_id as id FROM reposts r
      WHERE r.user_id = $1
    ) as user_posts
  `, [userId]);

  return parseInt(result.rows[0]?.count || '0');
}
```

#### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `/backend/src/scripts/migrate.ts`
- **å®Ÿè£…æ–¹æ³•**:
  - `migrations/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®SQLãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•æ¤œå‡º
  - `migrations` ãƒ†ãƒ¼ãƒ–ãƒ«ã§å®Ÿè¡Œæ¸ˆã¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½è·¡
  - Heroku release phase ã§è‡ªå‹•å®Ÿè¡Œ

#### Socket.io ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `/backend/src/index.ts`
- **å®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ**:
  - Express ã‚µãƒ¼ãƒãƒ¼ã¨ Socket.io ã‚’çµ±åˆ
  - DMé€ä¿¡æ™‚ã«ç›¸æ‰‹ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…ä¿¡
  - é€šçŸ¥ä½œæˆæ™‚ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…ä¿¡

---

## 8. æ—¢çŸ¥ã®èª²é¡Œã¨ä»Šå¾Œã®äºˆå®š

### æ—¢çŸ¥ã®èª²é¡Œ

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- [ ] ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®å–å¾—ãŒé…ã„ (N+1å•é¡Œã®å¯èƒ½æ€§)
- [ ] ç”»åƒãƒ»å‹•ç”»ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æœ€é©åŒ–ãŒå¿…è¦
- [ ] ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§å¤§é‡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæ™‚ã®ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯æ‡¸å¿µ

#### UX
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ãŒé…å»¶ã™ã‚‹ã“ã¨ãŒã‚ã‚‹
- [ ] å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®é€²æ—è¡¨ç¤ºãŒãªã„
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã§ãªã„

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…ãŒä¸ååˆ†
- [ ] XSSå¯¾ç­–ã®è¿½åŠ æ¤œè¨¼ãŒå¿…è¦
- [ ] CSRFå¯¾ç­–ã®å®Ÿè£…

### ä»Šå¾Œã®å®Ÿè£…äºˆå®š

#### Phase 2 æ®‹ã‚Š
- [ ] ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°æ©Ÿèƒ½
  - ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¿½åŠ 
  - æŠ•ç¨¿ã‹ã‚‰ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’æŠ½å‡º
  - ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°æ¤œç´¢
  - ãƒˆãƒ¬ãƒ³ãƒ‰è¡¨ç¤º

- [ ] å…¨æ–‡æ¤œç´¢
  - PostgreSQL ã® `ts_vector` ã‚’ä½¿ç”¨
  - æŠ•ç¨¿å†…å®¹ã®å…¨æ–‡æ¤œç´¢
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ»è¡¨ç¤ºåã®éƒ¨åˆ†ä¸€è‡´æ¤œç´¢

- [ ] ã‚°ãƒ«ãƒ¼ãƒ—DM
  - ã‚°ãƒ«ãƒ¼ãƒ—ä¼šè©±ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¿½åŠ 
  - 3äººä»¥ä¸Šã®ä¼šè©±ã‚’ã‚µãƒãƒ¼ãƒˆ

#### Phase 3 (å°†æ¥çš„ãªæ‹¡å¼µ)
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ›´æ–°
- [ ] ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ (Web Push API)
- [ ] ãƒ¡ãƒ‡ã‚£ã‚¢ã®CDNæœ€é©åŒ–
- [ ] ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
- [ ] ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª (React Native)
- [ ] ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ (@username)
- [ ] ãƒãƒ¼ãƒ«æ©Ÿèƒ½
- [ ] ã‚¹ãƒšãƒ¼ã‚¹æ©Ÿèƒ½ (éŸ³å£°ãƒãƒ£ãƒƒãƒˆ)
- [ ] ãƒ•ãƒªãƒ¼ãƒˆæ©Ÿèƒ½ (24æ™‚é–“ã§æ¶ˆãˆã‚‹æŠ•ç¨¿)

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–è¨ˆç”»
- [ ] Redis ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å°å…¥
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æœ€é©åŒ–
- [ ] ç”»åƒã®WebPå¤‰æ›
- [ ] Lazy Loading ã®æ”¹å–„
- [ ] GraphQL ã¸ã®ç§»è¡Œæ¤œè¨

---

## ğŸ“Š æœ€è¿‘ã®ä¸»è¦ãªå¤‰æ›´å±¥æ­´

### 2025-11-04
- âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã®ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å•é¡Œã‚’ä¿®æ­£
  - ã‚»ãƒ³ãƒãƒãƒ«è¦ç´ ã®ãƒã‚¦ãƒ³ãƒˆã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œã‚’è§£æ±º
  - ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯refãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…

- âœ… ç·ãƒã‚¹ãƒˆæ•°ã®è¡¨ç¤ºæ©Ÿèƒ½ã‚’è¿½åŠ 
  - `PostModel.countByUser()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
  - `getUserByUsername` APIã« `postCount` ã‚’è¿½åŠ 
  - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã§æœ€åˆã‹ã‚‰ç·æ•°ã‚’è¡¨ç¤º

### 2025-11-03
- âœ… ç¸¦é•·å‹•ç”»ã®ã‚µã‚¤ã‚ºèª¿æ•´
  - VideoPlayerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä¿®æ­£
  - max-height: 400pxã§åˆ¶é™
  - Flexboxä¸­å¤®å¯„ã›ã§é»’å¸¯è¡¨ç¤º

- âœ… å›ºå®šæŠ•ç¨¿ãƒãƒƒã‚¸ã®è¡¨ç¤ºåˆ¶å¾¡
  - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã®ã¿ã«è¡¨ç¤º
  - `showPinnedBadge` propã‚’è¿½åŠ 

### 2025-11-02
- âœ… Herokuæœ¬ç•ªç’°å¢ƒã¸ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
  - release phaseã§ã®è‡ªå‹•ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  - å…¨10ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®é©ç”¨å®Œäº†

### 2025-11-01
- âœ… å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã®å®Ÿè£…
  - å‹•ç”»ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¿½åŠ 
  - GCSã¸ã®å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  - ã‚µãƒ ãƒã‚¤ãƒ«è‡ªå‹•ç”Ÿæˆ

---

## ğŸ“ ãƒ¡ãƒ¢

### ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®æ³¨æ„äº‹é …
- **Heroku**: heroku.ymlã§Dockerãƒ‡ãƒ—ãƒ­ã‚¤ã€release phaseã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è‡ªå‹•å®Ÿè¡Œ
- **Vercel**: ç’°å¢ƒå¤‰æ•°ã« `NEXT_PUBLIC_API_URL` ã‚’è¨­å®šå¿…è¦
- **GCS**: ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã‚’Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦ç’°å¢ƒå¤‰æ•°ã«è¨­å®š

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯Dockerã§èµ·å‹• (`docker-compose up`)
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ `pnpm dev` ã§èµ·å‹•
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ `pnpm migrate` (ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰)

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„
- TypeScript strict ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹
- ESLint + Prettierä½¿ç”¨
- ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æ—¥æœ¬èªOK
- ãƒ–ãƒ©ãƒ³ãƒå: `feature/æ©Ÿèƒ½å`

---

**æœ€çµ‚æ›´æ–°**: 2025-11-04
**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ**: Claude Code
